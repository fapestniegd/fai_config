#!/bin/sh

PREREQ=""
prereqs(){
    echo "$PREREQ"
}

case $1 in
    prereqs)
        prereqs
        exit 0
    ;;
esac

# Begin real processing below this line
[ ! -d ${DESTDIR}/boot ] && mkdir -p ${DESTDIR}/boot

echo "copying cryptsetup and libcryptsetup.so.4initrd."
cp /sbin/cryptsetup "${DESTDIR}/sbin"
cp /lib/x86_64-linux-gnu/libcryptsetup.so.4.6.0 ${DESTDIR}/lib/xx86_64-linux-gnu/libcryptsetup.so.4.6.0
(cd ${DESTDIR}/lib/xx86_64-linux-gnu; ln -s libcryptsetup.so.4.6.0 libcryptsetup.so.4)

# copy the crypttab and keys into /boot on initrd
echo "copying boot to initrd."
/bin/cp -rp /target/boot/${HOSTNAME} ${DESTDIR}/boot/${HOSTNAME}

exit 0
